{
  "id": "ee2011c7-3fb8-4f62-810d-5f2dfdeb3434",
  "prefix": "DiskUsageByTable",
  "description": "Disk Usage by Table and Rows in Each Table",
  "body": "/***************************************************************************************************\r\nScript: To Get the Details of the Tables and it's Storage\r\n\t\t(or) To Query the Content in the Database\r\n***************************************************************************************************/\r\nUSE $DBNAME$;\r\nGO\r\n\r\n--\r\nDECLARE @TableSize TABLE\r\n(\r\n\tNAME NVARCHAR(128) NOT NULL,\r\n\trows CHAR(20) NOT NULL,\r\n\treserved VARCHAR(18) NOT NULL,\r\n\tdata VARCHAR(18) NOT NULL,\r\n\tindex_size VARCHAR(18) NOT NULL,\r\n\tunused VARCHAR(18) NOT NULL\r\n);\r\n\r\n--\r\nINSERT INTO @TableSize\r\nEXEC sys.sp_MSforeachtable \"EXEC sp_spaceused '?'\";\r\n--\r\n;\r\n\r\nWITH _TableSize\r\nAS (SELECT OBJECT_SCHEMA_NAME(O.object_id) AS \"SchemaName\",\r\n\t\t   TS.NAME AS \"TableName\",\r\n\t\t   FG.name AS \"FileGroup\",\r\n\t\t   CAST(TS.rows AS BIGINT) AS \"Rows\",\r\n\t\t   CAST(REPLACE(TS.reserved, 'KB', '') AS BIGINT) AS \"Reserved(KB)\",\r\n\t\t   CAST(REPLACE(TS.data, 'KB', '') AS BIGINT) AS \"DataSize(KB)\",\r\n\t\t   CAST(REPLACE(TS.index_size, 'KB', '') AS BIGINT) AS \"IndexSize(KB)\",\r\n\t\t   CAST(REPLACE(TS.unused, 'KB', '') AS BIGINT) AS \"UnUsed(KB)\",\r\n\t\t   EP.value AS \"Comments\"\r\n\tFROM @TableSize AS TS\r\n\t\tINNER JOIN sys.objects AS O\r\n\t\t\tON O.name = TS.NAME\r\n\t\tINNER JOIN sys.indexes AS I\r\n\t\t\tON I.object_id = O.object_id\r\n\t\tINNER JOIN sys.filegroups AS FG\r\n\t\t\tON FG.data_space_id = I.data_space_id\r\n\t\tLEFT JOIN sys.extended_properties AS EP\r\n\t\t\tON O.object_id = EP.major_id\r\n\t\t\t   AND EP.name = 'MS_Description'\r\n\t\t\t   AND EP.minor_id = 0\r\n\t\t\t   AND EP.class_desc = 'OBJECT_OR_COLUMN'\r\n\tWHERE O.type = 'U' -- User Created Tables\r\n)\r\nSELECT DISTINCT\r\n\t   DB_NAME() AS \"DatabaseName\",\r\n\t   TS.SchemaName,\r\n\t   TS.TableName,\r\n\t   TS.FileGroup,\r\n\t   TS.Rows,\r\n\t   TS.[Reserved(KB)],\r\n\t   TS.[DataSize(KB)],\r\n\t   TS.[IndexSize(KB)],\r\n\t   TS.[UnUsed(KB)],\r\n\t   TS.Comments\r\nFROM _TableSize AS TS\r\nORDER BY TS.[Reserved(KB)] DESC;\r\n"
}